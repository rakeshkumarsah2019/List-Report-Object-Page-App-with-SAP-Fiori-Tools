_schema-version: "3.1"
ID: <%- mtaPrefix %>-deploy-to-cf
description: Fiori elements app
version: 0.0.1

parameters:
    enable-parallel-deployments: true
    deploy_mode: html5-repo

build-parameters:
  before-all:
  - builder: custom
    commands:
    - npm install

modules:
    - name: <%- namespacedAppName %>
      type: html5
      path: <%- relativePath %>
      build-parameters:
          builder: custom
          commands:
              - npm run deploy
          supported-platforms: []
          build-result: dist

    # deployer module that uploads the app to the html5-repo
    - name: <%- mtaPrefix %>-deployer
      type: com.sap.html5.application-content
      path: deployer
      requires:
          - name: <%- mtaPrefix %>-html5-repo-host
      parameters:
          memory: 64M
          disk-quota: 128M
          content-target: true
      build-parameters:
          requires:
              - name: <%- namespacedAppName %>
                artifacts:
                    - "./*"
                target-path: resources/<%- relativePath %>
          ignore: [".gitignore"]

    # entry point for the app
    - name: <%- mtaPrefix %>-router
      type: approuter.nodejs
      path: router
      parameters:
          disk-quota: 256M
          memory: 128M
          routes:
              - route: https://<%- mtaPrefix %>-${org}-${space}.${default-domain}
      requires:
          - name: <%- mtaPrefix %>-html5-repo-runtime
          - name: <%- mtaPrefix %>-destination
          - name: <%- mtaPrefix %>-uaa

resources:
  # serves the application at runtime
  - name: <%- mtaPrefix %>-html5-repo-runtime
    parameters:
      service-plan: app-runtime
      service: html5-apps-repo
    type: org.cloudfoundry.managed-service
  # required for deploying the app sources
  - name: <%- mtaPrefix %>-html5-repo-host
    parameters:
      service-plan: app-host
      service: html5-apps-repo
    type: org.cloudfoundry.managed-service
  # required to access the steampunk system as destination
  - name: <%- mtaPrefix %>-destination
    type: org.cloudfoundry.managed-service
    parameters:
      service: destination
      service-plan: lite
  # handles authentication and authorization
  - name: <%- mtaPrefix %>-uaa
    type: org.cloudfoundry.managed-service
    parameters:
      service-plan: application
      service: xsuaa
      config:
        xsappname: <%- mtaPrefix %>-demo-${org}
        tenant-mode: dedicated
